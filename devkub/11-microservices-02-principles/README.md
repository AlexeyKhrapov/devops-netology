
# 11.02 Микросервисы: принципы — Алексей Храпов

Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- Маршрутизация запросов к нужному сервису на основе конфигурации
- Возможность проверки аутентификационной информации в запросах
- Обеспечение терминации HTTPS

Обоснуйте свой выбор.

**Ответ:**

||NGINX Plus|Spring Cloud|Kong|Sentinel|KrakenD|
|:---|:---:|:---:|:---:|:---:|:---:|
|Маршрутизация запросов|LUA|yml, code|Plugins|Plugins|json|
|Аутентификация в запросах|+|+|+|+|+|
|Терминация HTTPS|+|+|+|+|+|

Исходя из информации, полученной из открытых источников, могу сделать вывод: в случае развертываения инфраструктуры в облаке лучшим инструментом являются шлюзы, предоставляеме постащиком услуг (Sbercloud API gateway, Yandex.cloud API gateway и т.д.) по причине наилучшей интерграции с другими сервисами, но эти сервисы конфгурируются через веб-интерфейс.

В случае необходимости использования стороннего шлюза наиболе подходящими под требования задания считаю Kong по следующим причинам:
- бесплатное решение;
- платформо-независимость;
- наличие готовых сборок для Kubernetes, Docker Swarm, Mesos 
- можно запускать на bare metal серверах;
- есть динамический алгоритм балансировки трафика;
- есть различные механизмы авторизации пользователя;
- широкий выбор LUA-модулей, расширяющих возможности.

---

## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- Поддержка кластеризации для обеспечения надежности
- Хранение сообщений на диске в процессе доставки
- Высокая скорость работы
- Поддержка различных форматов сообщений
- Разделение прав доступа к различным потокам сообщений
- Протота эксплуатации

Обоснуйте свой выбор.

**Ответ:**

| |RabbitMQ|Kafka|PULSAR|
|:---|:---:|:---:|:---:|
|Поддержка кластеризации|+|+|+|
|Хранение на диске|+|+|+|
|Скорость работы|~38 MB/s|~605 MB/s|~305 MB/s|
|Различные форматы сообщений|AMQP, MQTT, STOMP|Binary через TCP Socket|Binary через TCP Socket|
|Разграничение прав доступа|+|+|+|
|Простота эксплуатации|+|+|-|

На основании данных о брокерах сообщений считаю, что лучшим выбором для этого задания будет Kafka, т.к. он позволяет реализовать распределенную очередь с высокой пропускной способностью и длительное хранение больших объемов данных, достаточно широко распространён, хорошо масштабируется и имеет хорошую документацию.

---