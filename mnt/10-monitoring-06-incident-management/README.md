# 10.06. Инцидент-менеджмент — Алексей Храпов

## Задание 1

Составьте постмотрем, на основе реального сбоя системы Github в году.

Информация о сбое доступна [в виде краткой выжимки на русском языке](https://habr.com/ru/post/427301/) , а
также [развёрнуто на английском языке](https://github.blog-10-30-oct21-post-incident-analysis/).

---
**Ответ:**

## Краткое описание инцидента

В 2018 году с 22:52 UTC 21 октбяря по 23:03 UTC 22 октбяря из-за потери сетевого соединения между ЦОД и последующих проблем в работе кластера БД пользователи сайта GitHub.com не могли пользоваться сервисами веб-хуков, а также сборкой и публикацией GitHub Page, предоставляемая информация была неактуальна и непоследовательна.

---

## Предшествующие события

Плановые работы по замене вышедшего из строя оптического оборудования.

---

## Причина инцидента

Некорректная настройка согласованности конфигурации Orchestrator'а с работой на уровне приложения.

---

## Воздействие

В течение 24 часов 11 минут не работали сервисы веб-хуков, а также сборка и публикация GitHub Page, предоставляемая информация была неактуальна и непоследовательна.

---

## Обнаружение

Внутренние системы мониторинга начали генерировать предупреждения, указывающие на многочисленные сбои.

---

## Реакция

Команда инженеров устранила инцидент в течение 24 часов 11 минут.

---

## Восстановление

Восстановление из резервных копий всех затронутых кластеров MySQL, с последующей синхронизацией реплик и накопившихся изменений.

---

## Таймлайн
|Время|События|
|:---:|:---|
|21.10.2018, 22:52 UTC|Потеря связи между серверами кластера БД MySQL на 43 секунды, в течении которого произошел переход первичных сервисов БД на реплики, в результате некорректной настройки согласованности конфигурации Orchestrator'а с работой на уровне приложения после восстановления соединения не получилось выполнить репликацию данных между узлами кластера|
|21.10.2018, 22:54 UTC|Внутренние системы мониторинга начали генерировать предупреждения, указывающие на многочисленные сбои в системах|
|21.10.2018, 23:02 UTC|Инженеры группы быстрого реагирования определили, что топологии многочисленных кластеров баз данных находятся в непредвиденном состоянии|
|21.10.2018, 23:07 UTC|Отвечающая команда решила вручную заблокировать внутренний инструмент развертывания|
|21.10.2018, 23:09 UTC|Команда респондентов поместила сайт в желтый статус и система эскалации переводит запрос в инцидент и направляет предупреждение координатору инцидентов|
|21.10.2018, 23:11 UTC|Координатор присоединился к команде|
|21.10.2018, 23:13 UTC|Координатор изменяет статус решения на красный, вызваны дополнительные инженеры из группы разработки баз данных| 
|21.10.2018, 23:19 UTC|Принято решение приостановить доставку веб-хуков и сборки GitHub Pages для сохранения целостности данных|
|22.10.2018, 00:05 UTC|Инженеры, участвующие в группе реагирования на инциденты, начали разработку плана по устранению несоответствий данных и внедрению процедур аварийного переключения для MySQL, оповещение пользователей о предстоящем контролируемом переходе на другой ресурс внутренней СХД|
|22.10.2018, 00:41 UTC|Инициирован процесс восстановления из резервных копирований для всех затронутых кластеров MySQL|
|22.10.2018, 06:51 UTC|Несколько кластеров завершили восстановление из резервных копий и начали репликацию новых данных, более крупные кластеры находятся в процессе восстановления|
|22.10.2018, 07:46 UTC|GitHub опубликовал сообщение в блоге , чтобы предоставить больше контекста|
|22.10.2018, 11:12 UTC|Восстановился основной кластер БД, но множество реплик БД продолжали отставать от основной на несколько часов, это приводило к тому что, пользователи видели несогласованные данные при взаимодействии со службами сайта|
|22.10.2018, 13:15 UTC|Пик нагрузки трафика на сайт, принято решение разворачивания дополнительных реплик на чтение|
|22.10.2018, 16:24 UTC|Реплики были синхронизированы, выполнено аварийное переключение на исходную топологию|
|22.10.2018, 16:45 UTC|Начался процесс обработки накопившихся событий|
|22.10.2018, 23:03 UTC|Все ожидающие сборки вебхуков и страниц были обработаны, подтверждена целостность и правильная работа всех систем. Статус сайта обновлен до зеленого |

---

## Последующие действия

- Внесение запросов не попавших в систему в процессе восстановления;
- Настройка конфигурации Orchestrator для управления топологиями кластеров MySQL и автоматического аварийного переключения, чтобы предотвратить передачу primary роли между регионами;
- Переход на новый механизм отчетов, информирующий о состоянии каждой службы;
- Разработка механизмов резервирования n+1 на уровне объекта с возможностью отказа одного центра обработки данных без воздействия на пользователя;
- Введение практики проверки сценариев сбоев и хаос-инжиниринга.

---