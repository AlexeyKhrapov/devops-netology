# 5.3. Введение. Экосистема. Архитектура. Жизненный цикл Docker контейнера — Алексей Храпов

## Задача 1

Сценарий выполения задачи:

- создайте свой репозиторий на https://hub.docker.com;
- выберете любой образ, который содержит веб-сервер Nginx;
- создайте свой fork образа;
- реализуйте функциональность:
запуск веб-сервера в фоне с индекс-страницей, содержащей HTML-код ниже:
```
<html>
<head>
Hey, Netology
</head>
<body>
<h1>I’m DevOps Engineer!</h1>
</body>
</html>
```
Опубликуйте созданный форк в своем репозитории и предоставьте ответ в виде ссылки на https://hub.docker.com/username_repo.

### Ответ:
https://hub.docker.com/r/ahr22/nginx

Файл с содержимым доступен в катклоге netology (http://0.0.0.0/netology)

---
## Задача 2

Посмотрите на сценарий ниже и ответьте на вопрос:
"Подходит ли в этом сценарии использование Docker контейнеров или лучше подойдет виртуальная машина, физическая машина? Может быть возможны разные варианты?"

Детально опишите и обоснуйте свой выбор.

--

Сценарий:

- Высоконагруженное монолитное java веб-приложение;
- Nodejs веб-приложение;
- Мобильное приложение c версиями для Android и iOS;
- Шина данных на базе Apache Kafka;
- Elasticsearch кластер для реализации логирования продуктивного веб-приложения - три ноды elasticsearch, два logstash и две ноды kibana;
- Мониторинг-стек на базе Prometheus и Grafana;
- MongoDB, как основное хранилище данных для java-приложения;
- Gitlab сервер для реализации CI/CD процессов и приватный (закрытый) Docker Registry.
### Ответ:
- Высоконагруженное монолитное java веб-приложение;
  - физический сервер, т.к. монолитное, селдовательно, в микросервисах не реализуемо без изменения кода,
   и т.к. высоконагруженное - необходим физический доступ к ресурсам, без использования гипервизора.
- Nodejs веб-приложение;
  - это веб-приложение, для таких приложений достаточно докера, противопоказаний для контейнерной реализации не вижу.
   В рамках микросервисной архитектуры также может быть хорошим решением.
- Мобильное приложение c версиями для Android и iOS;
  - Виртуальная машина, т.к. приложение в докере не имеет GUI, а это не подходит по описанию.
- Шина данных на базе Apache Kafka;
  - Зависит от передаваемых данных или контура (тест/прод), для прода и критически важных данных лучше виртуальная машина, 
   для теста достаточно Контейнерной реализации, если потеря данных при потере контенйера не является критичной 
   то можно и в контейнере.
- Elasticsearch кластер для реализации логирования продуктивного веб-приложения - три ноды elasticsearch, два logstash и две ноды kibana;
  - Сам Elasticsearch лучше установить на виртуальную машину, отказоустойчивость решается на уровне кластера, 
   кибану и логстэш можно вынести в докер-контейнер, или так же на виртуальные машины. Однако, я встречал вариант
  и установки всего в отдельных контейнерах. Вариант полностью из контейнеров, несомненно, даст преимущество в скорости 
  развертывания.
- Мониторинг-стек на базе Prometheus и Grafana;
  - сами системы не хранят как таковых данных, можно развернуть на Докере. Минусов не вижу, в плюсах скорость 
  развертывания, возможность масштабирования для различных задач. Например, у графаны есть ограничение на число 
  обрабатываемых метрик и может понадобиться разделения под разные задачи. 
- MongoDB, как основное хранилище данных для java-приложения;
  - можно использовать виртуальную машину, т.к. хранилище и не сказано, что приложение высоконагруженное.
   В Контейнере хранить БД с данными не подходит, для физического сервера может быть через чур расточительно.
- Gitlab сервер для реализации CI/CD процессов и приватный (закрытый) Docker Registry.
  - Контейнеры как типичное решение для этих задач. В [документации по развертыванию Docker Registry](https://docs.docker.com/registry/deploying/) 
  других вариантов даже не рассматривают. 
---
## Задача 3

- Запустите первый контейнер из образа ***centos*** c любым тэгом в фоновом режиме, подключив папку ```/data``` из текущей рабочей директории на хостовой машине в ```/data``` контейнера;
- Запустите второй контейнер из образа ***debian*** в фоновом режиме, подключив папку ```/data``` из текущей рабочей директории на хостовой машине в ```/data``` контейнера;
- Подключитесь к первому контейнеру с помощью ```docker exec``` и создайте текстовый файл любого содержания в ```/data```;
- Добавьте еще один файл в папку ```/data``` на хостовой машине;
- Подключитесь во второй контейнер и отобразите листинг и содержание файлов в ```/data``` контейнера.
### Ответ:
```bash
kad@g-deb-test:~/linuxdata$ docker run -t -v /home/kad/linuxdata:/data -d centos
Unable to find image 'centos:latest' locally
latest: Pulling from library/centos
a1d0c7532777: Pull complete 
Digest: sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177
Status: Downloaded newer image for centos:latest
db4e2f8bf78844744befc6e77888752d1bc20589de63badb71ad72337f9b1f7c
kad@g-deb-test:~/linuxdata$ docker run -t -v /home/kad/linuxdata:/data -d debian
Unable to find image 'debian:latest' locally
latest: Pulling from library/debian
0c6b8ff8c37e: Pull complete 
Digest: sha256:fb45fd4e25abe55a656ca69a7bef70e62099b8bb42a279a5e0ea4ae1ab410e0d
Status: Downloaded newer image for debian:latest
816c98054c4444bf44af4f33027d15ef4a1d0729722f5a52f52db4dfd629cbe2
kad@g-deb-test:~/linuxdata$ docker ps
CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES
816c98054c44   debian    "bash"        8 seconds ago    Up 7 seconds              nifty_allen
db4e2f8bf788   centos    "/bin/bash"   28 seconds ago   Up 27 seconds             gallant_turing
kad@g-deb-test:~/linuxdata$ docker exec -it gallant_turing /bin/bash
[root@db4e2f8bf788 /]# touch /data/centos-container
[root@db4e2f8bf788 /]# exit
kad@g-deb-test:~/linuxdata$ touch ./host-vm
kad@g-deb-test:~/linuxdata$ docker exec -it nifty_allen bash
root@816c98054c44:/# ls -l /data
total 0
-rw-r--r-- 1 root root 0 Jan 30 15:38 centos-container
-rw-r--r-- 1 1000 1000 0 Jan 30 15:39 host-vm
root@816c98054c44:/# 
exit
kad@g-deb-test:~/linuxdata$ docker stop $(docker ps -a -q)
816c98054c44
db4e2f8bf788
3b7fdd869213
be9aff9db32a
b7145e91d3ee
df254b99cb8a
564ff5346b7d
b1a620b067d3
```

---
## Задача 4 (*)

Воспроизвести практическую часть лекции самостоятельно.

Соберите Docker образ с Ansible, загрузите на Docker Hub и пришлите ссылку вместе с остальными ответами к задачам.

### Ответ:

https://hub.docker.com/r/ahr22/ansible

---